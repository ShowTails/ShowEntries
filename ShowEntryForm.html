<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rabbit Show Entry</title>

  <style>
    :root {
      --border: #111;
      --muted: #f2f2f2;
    }

    body {
      font-family: Arial, Helvetica, sans-serif;
      margin: 18px;
      color: #000;
    }

    /* ACTION BUTTON */
    .actions {
      text-align: right;
      margin-bottom: 10px;
    }

    .actions button {
      font-size: 12px;
      padding: 6px 12px;
      border: 1px solid #111;
      background: #fff;
      cursor: pointer;
    }

    .actions button:hover {
      background: #f2f2f2;
    }

    /* HEADER */
    .header {
      text-align: center;
    }

    .header h1 {
      font-size: 20px;
      margin: 0 0 6px;
    }

    .header .meta {
      font-size: 12px;
      margin: 0 0 14px;
    }

    /* EXHIBITOR INFO */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 18px;
      font-size: 12px;
      margin: 10px 0 14px;
    }

    .field {
      line-height: 1.35;
    }

    .label {
      font-weight: 700;
    }

    .value {
      border-bottom: 1px solid #aaa;
      padding-bottom: 1px;
      display: inline-block;
      min-width: 140px;
    }

    /* TABLE */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    th,
    td {
      border: 1px solid var(--border);
      padding: 4px 6px;
    }

    th {
      background: var(--muted);
      text-align: center;
      font-weight: 700;
    }

    td {
      text-align: center;
      vertical-align: middle;
    }

    td.left {
      text-align: left;
    }

    .x {
      font-weight: 700;
    }

    /* TOTAL */
    .totals {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
      font-size: 12px;
      font-weight: 700;
      gap: 8px;
    }

    /* FOOTER */
    .footer {
      margin-top: 16px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      font-size: 11px;
    }

    .line {
      border-bottom: 1px solid #000;
      height: 14px;
    }

    /* PRINT RULES */
    @media print {
      body {
        margin: 0.5in;
      }
      .actions {
        display: none;
      }
    }
  </style>
</head>

<body>

  <!-- PRINT BUTTON -->
  <div class="actions">
    <button onclick="window.print()">Save as PDF / Print</button>
  </div>

  <!-- HEADER -->
  <div class="header">
    <h1 data-field="show_name"></h1>
    <div class="meta">
      <span data-field="hosting_club"></span> •
      <span data-field="show_date"></span> •
      <span data-field="show_type"></span> •
      Shows: <span data-field="show_ids"></span>
    </div>
  </div>

  <!-- EXHIBITOR INFO -->
  <div class="grid">
    <div class="field">
      <span class="label">Exhibitor:</span>
      <span class="value" data-field="exhibitor_name"></span>
    </div>
    <div class="field">
      <span class="label">Phone:</span>
      <span class="value" data-field="exhibitor_phone"></span>
    </div>
    <div class="field">
      <span class="label">Address:</span>
      <span class="value" data-field="exhibitor_address"></span>
    </div>
    <div class="field">
      <span class="label">Email:</span>
      <span class="value" data-field="exhibitor_email"></span>
    </div>
  </div>

  <!-- ENTRY TABLE -->
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Breed</th>
        <th>Variety</th>
        <th>Ear / Tattoo</th>
        <th>Class</th>
        <th>Sex</th>
        <th>A</th>
        <th>B</th>
        <th>C</th>
        <th>D</th>
        <th>Fee</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

  <!-- TOTAL -->
  <div class="totals">
    <div>Total owed for all entries:</div>
    <div>$<span id="totalOwed">0.00</span></div>
  </div>

  <!-- SIGNATURE -->
  <div class="footer">
    <div>
      <strong>Exhibitor Signature</strong>
      <div class="line"></div>
    </div>
    <div>
      <strong>Date</strong>
      <div class="line"></div>
    </div>
  </div>

<script>
  const params = new URLSearchParams(window.location.search);

  /* Populate all data-field elements */
  document.querySelectorAll("[data-field]").forEach(el => {
    const key = el.getAttribute("data-field");
    const value = params.get(key);
    if (value !== null) {
      el.textContent = decodeURIComponent(value);
    }
  });

  const enabledShows = new Set(
    (params.get("show_ids") || "")
      .split(",")
      .map(s => s.trim().toUpperCase())
      .filter(Boolean)
  );

  const tbody = document.getElementById("rows");
  let total = 0;
  let rowNum = 0;

  function hasRabbit(i) {
    return (
      params.get(`r${i}_breed`) ||
      params.get(`r${i}_variety`) ||
      params.get(`r${i}_ear`) ||
      params.get(`r${i}_class`) ||
      params.get(`r${i}_sex`) ||
      params.get(`r${i}_shows`) ||
      params.get(`r${i}_fee`)
    );
  }

  function mark(i, letter) {
    if (!enabledShows.has(letter)) return "";
    const selected = (params.get(`r${i}_shows`) || "")
      .split(",")
      .map(s => s.trim().toUpperCase());
    return selected.includes(letter) ? "<span class='x'>X</span>" : "";
  }

  function money(n) {
    return Number(n || 0).toFixed(2);
  }

  for (let i = 1; i <= 20; i++) {
    if (!hasRabbit(i)) continue;

    rowNum++;
    const fee = Number(params.get(`r${i}_fee`) || 0);
    if (!isNaN(fee)) total += fee;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${rowNum}</td>
      <td class="left">${escapeHtml(params.get(`r${i}_breed`))}</td>
      <td class="left">${escapeHtml(params.get(`r${i}_variety`))}</td>
      <td>${escapeHtml(params.get(`r${i}_ear`))}</td>
      <td>${escapeHtml(params.get(`r${i}_class`))}</td>
      <td>${escapeHtml(params.get(`r${i}_sex`))}</td>
      <td>${mark(i,"A")}</td>
      <td>${mark(i,"B")}</td>
      <td>${mark(i,"C")}</td>
      <td>${mark(i,"D")}</td>
      <td>$${money(fee)}</td>
    `;
    tbody.appendChild(tr);
  }

  document.getElementById("totalOwed").textContent = money(total);

  function escapeHtml(str) {
    return (str || "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }
</script>

</body>
</html>
